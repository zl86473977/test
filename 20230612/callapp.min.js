!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self).CallApp=factory()}(this,(function(){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var ua=navigator.userAgent||"",semverCompare=function semverCompare(verionA,versionB){for(var isNaN=Number.isNaN,splitA=verionA.split("."),splitB=versionB.split("."),i=0;i<3;i++){var snippetA=Number(splitA[i]),snippetB=Number(splitB[i]);if(snippetA>snippetB)return 1;if(snippetB>snippetA)return-1;if(!isNaN(snippetA)&&isNaN(snippetB))return 1;if(isNaN(snippetA)&&!isNaN(snippetB))return-1}return 0},getIOSVersion=function getIOSVersion(){var version=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return Number.parseInt(version[1],10)},getWeChatVersion=function getWeChatVersion(){var version;return navigator.appVersion.match(/micromessenger\/(\d+\.\d+\.\d+)/i)[1]},isAndroid=/android/i.test(ua),isIos=/iphone|ipad|ipod/i.test(ua),isWechat=/micromessenger\/([\d.]+)/i.test(ua),isWeibo=/(weibo).*weibo__([\d.]+)/i.test(ua),isBaidu=/(baiduboxapp)\/([\d.]+)/i.test(ua),isQQ=/qq\/([\d.]+)/i.test(ua),isQQBrowser=/(qqbrowser)\/([\d.]+)/i.test(ua),isQzone=/qzone\/.*_qz_([\d.]+)/i.test(ua),isOriginalChrome=/chrome\/[\d.]+ mobile safari\/[\d.]+/i.test(ua)&&isAndroid&&ua.indexOf("Version")<0,isSafari=/safari\/([\d.]+)$/i.test(ua)&&isIos&&ua.indexOf("Crios")<0&&0===ua.indexOf("Mozilla"),hidden,visibilityChange,iframe,CallApp;function buildScheme(config,options){var path=config.path,param=config.param,customBuildScheme=options.buildScheme;if(void 0!==customBuildScheme)return customBuildScheme(config,options);var _options$scheme=options.scheme,host=_options$scheme.host,port=_options$scheme.port,protocol=_options$scheme.protocol,portPart=port?":".concat(port):"",hostPort=host?"".concat(host).concat(portPart,"/"):"",query=void 0!==param?Object.keys(param).map((function(key){return"".concat(key,"=").concat(param[key])})).join("&"):"",urlQuery=query?"?".concat(query):"";return"".concat(protocol,"://").concat(hostPort).concat(path).concat(urlQuery)}function generateScheme(config,options){var outChain=options.outChain,uri=buildScheme(config,options);if(void 0!==outChain&&outChain){var protocol=outChain.protocol,path=outChain.path,key=outChain.key;uri="".concat(protocol,"://").concat(path,"?").concat(key,"=").concat(encodeURIComponent(uri))}return uri}function generateIntent(config,options){var outChain=options.outChain,intent=options.intent,fallback=options.fallback;if(void 0===intent)return"";var keys,intentParam=Object.keys(intent).map((function(key){return"".concat(key,"=").concat(intent[key],";")})).join(""),intentTail="#Intent;".concat(intentParam,"S.browser_fallback_url=").concat(encodeURIComponent(fallback),";end;"),urlPath=buildScheme(config,options);if(void 0!==outChain&&outChain){var path=outChain.path,key=outChain.key;return"intent://".concat(path,"?").concat(key,"=").concat(encodeURIComponent(urlPath)).concat(intentTail)}return urlPath=urlPath.slice(urlPath.indexOf("//")+2),"intent://".concat(urlPath).concat(intentTail)}function generateUniversalLink(config,options){var universal=options.universal;if(void 0===universal)return"";var host=universal.host,pathKey=universal.pathKey,path=config.path,param=config.param,query=void 0!==param?Object.keys(param).map((function(key){return"".concat(key,"=").concat(param[key])})).join("&"):"",urlQuery=query?"&".concat(query):"";return"https://".concat(host,"?").concat(pathKey,"=").concat(path).concat(urlQuery)}function generateYingYongBao(config,options){var url=generateScheme(config,options);return"".concat(options.yingyongbao,"&android_schema=").concat(encodeURIComponent(url))}function getSupportedProperty(){void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange")}function isPageHidden(){return void 0!==hidden&&document[hidden]}function evokeByLocation(uri){window.top.location.href=uri}function evokeByIFrame(uri){iframe||((iframe=document.createElement("iframe")).frameBorder="0",iframe.style.cssText="display:none;border:0;width:0;height:0;",document.body.append(iframe)),iframe.src=uri}function checkOpen(cb,timeout){var timer=setTimeout((function(){var pageHidden;isPageHidden()||cb()}),timeout);void 0!==visibilityChange?document.addEventListener(visibilityChange,(function(){clearTimeout(timer)})):window.addEventListener("pagehide",(function(){clearTimeout(timer)}))}return getSupportedProperty(),function(){function CallApp(options){_classCallCheck(this,CallApp),_defineProperty(this,"options",void 0);var defaultOptions={timeout:2e3};this.options=_extends(defaultOptions,options)}return _createClass(CallApp,[{key:"generateScheme",value:function generateScheme$1(config){return generateScheme(config,this.options)}},{key:"generateIntent",value:function generateIntent$1(config){return generateIntent(config,this.options)}},{key:"generateUniversalLink",value:function generateUniversalLink$1(config){return generateUniversalLink(config,this.options)}},{key:"generateYingYongBao",value:function generateYingYongBao$1(config){return generateYingYongBao(config,this.options)}},{key:"checkOpen",value:function checkOpen$1(cb){return checkOpen(cb,this.options.timeout)}},{key:"fallToAppStore",value:function fallToAppStore(){var _this=this;this.checkOpen((function(){evokeByLocation(_this.options.appstore)}))}},{key:"fallToFbUrl",value:function fallToFbUrl(){var _this2=this;this.checkOpen((function(){evokeByLocation(_this2.options.fallback)}))}},{key:"fallToCustomCb",value:function fallToCustomCb(callback){this.checkOpen((function(){callback()}))}},{key:"open",value:function open(config){var _this$options=this.options,universal=_this$options.universal,appstore=_this$options.appstore,logFunc=_this$options.logFunc,intent=_this$options.intent,callback=config.callback,supportUniversal=void 0!==universal,schemeURL=this.generateScheme(config),checkOpenFall;void 0!==logFunc&&logFunc(),isIos?isWechat&&-1===semverCompare(getWeChatVersion(),"7.0.5")||isQQ||isWeibo?evokeByLocation(appstore):getIOSVersion()<9?(evokeByIFrame(schemeURL),checkOpenFall=this.fallToAppStore):!supportUniversal||isQQBrowser||isQzone?(evokeByLocation(schemeURL),checkOpenFall=this.fallToAppStore):evokeByLocation(this.generateUniversalLink(config)):isWechat&&void 0!==this.options.yingyongbao?evokeByLocation(this.generateYingYongBao(config)):isOriginalChrome?void 0!==intent?evokeByLocation(this.generateIntent(config)):(evokeByLocation(schemeURL),checkOpenFall=this.fallToFbUrl):isWechat||isBaidu||isWeibo||isQzone?evokeByLocation(this.options.fallback):(evokeByIFrame(schemeURL),checkOpenFall=this.fallToFbUrl),void 0===callback?checkOpenFall&&checkOpenFall.call(this):this.fallToCustomCb(callback)}}]),CallApp}()}));