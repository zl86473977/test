<!DOCTYPE html>
<html data-kantu="1">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<meta name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
		<link rel="shortcut icon"
			href="https://p9-orange.byteorge.com/img/ad-tetris-site/web.business.image/202210315d0dd43921d9b1b04c0e8eb1~q75.png">
		<title style="text-align: center;">立即购买</title>
		<script src="./callapp.min.js"></script>
		<script>
			(function(doc, win) {
				var htmlFont = function() {
					var maxWidth = 500;
					var docEl = doc.documentElement,
						l = docEl.clientWidth > maxWidth ? maxWidth : docEl.clientWidth,
						f;
					f = l / 375 * 37.5;
					docEl.style.fontSize = f + "px"
				};
				htmlFont();
				win.addEventListener("resize", htmlFont, false)
			})(document, window);
		</script>
		<script>
			(function(r, d, s) {
				r._tt_config = true;
				var _baq = (r._baq = r._baq || []);
				_baq.methods = ["track", "off", "on"];
				_baq.factory = function(method) {
					return function() {
						var args = Array.prototype.slice.call(arguments);
						args.unshift(method);
						_baq.push(args);
						return _baq
					}
				};
				for (var i = 0; i < _baq.methods.length; i++) {
					var key = _baq.methods[i];
					_baq[key] = _baq.factory(key)
				}
				_baq.load = function() {
					var js, fjs = d.getElementsByTagName(s)[0];
					js = d.createElement(s);
					js.src = "https://analytics.oceanengine.com/api/v2/js/sdk";
					fjs.parentNode.insertBefore(js, fjs)
				};
				_baq.load();
				if (_baq.invoked) {
					return
				}
				_baq.invoked = true;
				_baq.track("pageview")
			})(window, document, "script");
		</script>
		<script>
			_baq.on('insight')
		</script>
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				background-color: #fff;
			}

			html {
				height: 100%;
			}

			body {
				min-height: 100%;
			}

			.app {
				min-height: 100%;
				width: 10rem;
				margin: 0 auto;
				position: relative;
			}

			.stream-frame {
				position: relative;
			}

			.text {
				width: 100%;
				height: auto;
				font-size: 0.27rem;
				color: #c1c1c1;
				background-color: #f8f8f8;
				padding: 0.21rem 0;
				text-align: center;
			}

			.bg-frame {
				position: relative;
			}

			.bg-image {
				width: 100%;
				display: block;
			}

			.coupon-frame {
				position: relative;
				margin: 0 auto;
				width: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.coupon-click {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				margin: 0 auto;
				width: 8rem;
				height: 3rem;
			}

			.coupon-image {
				width: 100%;
			}
		</style>
	</head>
	<body style="font-size: 0.373333rem;">
		<div class="app" id="app-click">
			<div class="stream-frame">
				<div class="bg-frame">
					<img class="bg-image"
						src="https://p9-orange.byteorge.com/img/ad-tetris-site/web.business.image/202212265d0d2839ec30a84140cea879~q75.jpeg"
						alt="" />
				</div>
				<div class="coupon-frame">
					<img class="coupon-image"
						src="https://p9-orange.byteorge.com/img/ad-tetris-site/web.business.image/202212265d0d56cc81e0613a493cabb9~q75.gif"
						alt="" />
					<div class="coupon-click" onclick="openApp()"></div>
				</div>
			</div>
			<div class="stream-bricks">
				<div class="text">福建莆田禾浩大健康咨询有限公司</div>
			</div>
		</div>
		<script>
			const query = window.location.search.substring(1);
			const rawParams = query.split("&");
			const params = {
				"urlType": "ITEM_URL"
			};
			for (let i = 0; i < rawParams.length; i++) {
				const pair = rawParams[i].split("=");
				params[pair[0]] = pair[1];
			}
			let loading = false;

			function openApp() {
				if (!loading) {
					getLink();
				}
			}

			function getLink(retryTimes = 1) {
				if (retryTimes > 3) {
					loading = false;
					return;
				}
				loading = true;
				const httpRequest = new XMLHttpRequest;
				const url = "https://api.fifay.cn/fifay-ad/oe/v2/link";
				httpRequest.open("POST", url, true);
				httpRequest.setRequestHeader("Content-type", "application/json");
				httpRequest.send(JSON.stringify(params));
				httpRequest.onreadystatechange = function() {
					if (httpRequest.readyState === 4) {
						if (httpRequest.status === 200) {
							const result = JSON.parse(httpRequest.responseText);
							if (result.code === 200) {
								itemUrl = result.data;
								callAppLib(itemUrl.schemeUrl, itemUrl.url);
								loading = false;
								return;
							}
						}
						retryTimes++;
						loading = false;
						getLink(retryTimes);
					}
				}
			}

			function callAppLib(schemeUrl, url) {
				if (url.indexOf('jd.com') > -1) {
					url = schemeUrl !== null && params['urlType'] !== 'TJM_URL' ?
						'https://platform.m.jd.com/swm-stable/douyin-jump/index?pageType=2&spreadUrl=' + encodeURIComponent(
							url) : url;
				}
				if ((typeof CallApp !== 'undefined') && (schemeUrl !== null)) {
					const schemeList = schemeUrl.split('://');
					const option = {
						scheme: {
							protocol: schemeList[0],
						},
						appstore: url,
						fallback: url,
						timeout: 1500,
					};
					const callAppAction = new CallApp(option);
					callAppAction.open({
						path: schemeList[1]
					});
				} else {
					window.location.href = url;
				}
			}
			const appClick = document.getElementById('app-click');
			if (appClick && params['clickid'] && params['clickid'] !== '__CLICKID__') {
				appClick.onclick = openApp
			}
		</script>
		<script>
			class WebTracker {
				constructor(opt) {
					var _a, _b;
					this.timer = null;
					this.time = 10;
					this.count = 10;
					this.arr = [];
					this.time = (_a = opt.time) !== null && _a !== void 0 ? _a : 10;
					this.count = (_b = opt.count) !== null && _b !== void 0 ? _b : 10;
					this.url = 'https://' + opt.project + '.' + opt.host + '/logstores/' + opt.logstore + '/track';
					this.opt = opt;
					if (opt.installUnloadHook && typeof opt.installUnloadHook === 'function') {
						opt.installUnloadHook(() => {
							this.platformSend(this.assemblePayload())
						})
					}
				}
				assemblePayload(arr = this.arr) {
					const payload = {
						__logs__: arr
					};
					if (this.opt.tags) {
						payload.__tags__ = this.opt.tags
					}
					if (this.opt.topic) {
						payload.__topic__ = this.opt.topic
					}
					if (this.opt.source) {
						payload.__source__ = this.opt.source
					}
					return JSON.stringify(payload)
				}
				platformSend(payloadStr) {
					if (this.opt.sendPayload && typeof this.opt.sendPayload === 'function') {
						this.opt.sendPayload(this.url, payloadStr)
					}
				}
				transString(obj) {
					let newObj = {};
					for (let i in obj) {
						if (typeof obj[i] == 'object') {
							newObj[i] = JSON.stringify(obj[i])
						} else {
							newObj[i] = String(obj[i])
						}
					}
					return newObj
				}
				sendImmediateInner() {
					if (this.arr && this.arr.length > 0) {
						this.platformSend(this.assemblePayload());
						if (this.timer != null) {
							clearTimeout(this.timer);
							this.timer = null
						}
						this.arr = []
					}
				}
				sendInner() {
					if (this.timer) {
						if (this.arr.length >= this.count) {
							clearTimeout(this.timer);
							this.timer = null;
							this.sendImmediateInner()
						}
					} else {
						const that = this;
						if (this.arr.length >= this.count || this.time <= 0) {
							this.sendImmediateInner()
						} else {
							this.timer = setTimeout(function() {
								that.sendImmediateInner()
							}, this.time * 1000)
						}
					}
				}
				send(originLog) {
					const obj = this.transString(originLog);
					this.arr.push(obj);
					this.sendInner()
				}
				sendImmediate(originLog) {
					const obj = this.transString(originLog);
					this.arr.push(obj);
					this.sendImmediateInner()
				}
				sendBatchLogs(originLogs) {
					const logs = originLogs.map((originLog) => this.transString(originLog));
					this.arr.push(...logs);
					this.sendInner()
				}
				sendBatchLogsImmediate(originLogs) {
					const logs = originLogs.map((originLog) => this.transString(originLog));
					this.arr.push(...logs);
					this.sendImmediateInner()
				}
			}

			function sendBeacon(url, payload) {
				if (navigator && navigator.sendBeacon) {
					return navigator.sendBeacon(`${url}?APIVersion=0.6.0`, payload)
				}
				return false
			}

			function sendUseXhr(url, reqPayload) {
				const httpRequest_ = new window.XMLHttpRequest();
				httpRequest_.open('POST', url, true);
				httpRequest_.setRequestHeader('x-log-apiversion', '0.6.0');
				httpRequest_.setRequestHeader('x-log-bodyrawsize', reqPayload.length.toString());
				const blob = new Blob([reqPayload], {
					type: 'application/x-protobuf'
				});
				httpRequest_.send(blob)
			}

			function send(url, payload) {
				try {
					if (!sendBeacon(url, payload)) {
						sendUseXhr(url, payload)
					}
				} catch (ex) {
					if (window && window.console && typeof window.console.error === 'function') {
						console.error('Failed to log to ali log service because of this exception:\n' + ex);
						console.error('Failed log data:', url)
					}
				}
			}
			class WebTrackerBrowser extends WebTracker {
				constructor(opt) {
					const superOpt = Object.assign({}, opt, {
						installUnloadHook: (hook) => {
							window.addEventListener('beforeunload', () => {
								hook()
							})
						},
						sendPayload: (url, payload) => {
							send(url, payload)
						},
					});
					super(superOpt)
				}
			}

			function defineGlobal(global, name, api) {
				global[name] = api
			}
			defineGlobal(window, 'SLS_Tracker', WebTrackerBrowser);
			try {
				const params = {};
				params['userAgent'] = navigator.userAgent;
				const referer = window.location.href;
				const refererSplit = referer.split('?');
				if (refererSplit.length > 1) {
					params['url'] = refererSplit[0];
					const rawParams = refererSplit[1].split('&');
					for (let i = 0; i < rawParams.length; i++) {
						const pair = rawParams[i].split('=');
						params[pair[0]] = pair[1]
					}
				} else {
					params['referer'] = referer
				}
				const tracker = new SLS_Tracker({
					host: 'cn-hangzhou.log.aliyuncs.com',
					project: 'fifay-ad',
					logstore: 'web-track-log'
				});
				const st = new Date().getTime();
				const img1 = document.querySelector('.bg-image');
				const img2 = document.querySelector('.coupon-image');
				let imgLoaded = false;
				let loadTime = null;
				if (img1) {
					img1.addEventListener('load', function() {
						imgLoaded = true;
						loadTime = new Date().getTime() - st
					})
				}
				if (img2) {
					img2.addEventListener('load', function() {
						imgLoaded = true;
						loadTime = new Date().getTime() - st
					})
				}
				setTimeout(function() {
					params.scene = imgLoaded ? 'Loaded' : 'UnLoad';
					params.loadTime = loadTime;
					tracker.sendImmediate(params)
				}, 2000)
			} catch (e) {}
		</script>
	</body>
</html>
